üß™ Testing refactored components...
‚úÖ New PostgreSQL client connected
üîó Client acquired from pool
üîì Client released back to pool
‚úÖ Database connection: OK
‚úÖ Authentication middleware: OK
‚úÖ Response utilities: OK
‚úÖ Database utilities: OK
üéâ All components tested successfully!
üåê WebSocket server initialized
üßπ WebSocket cleanup scheduler started
üöÄ Refactored server running on port 3001
üìä Health check: http://localhost:3001/api/health
üîê Auth test: http://localhost:3001/api/auth/login
‚öôÔ∏è System routes: http://localhost:3001/api/system/health
üåê WebSocket server initialized
ValidationError: The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users. See https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/ for more information.
    at Object.xForwardedForHeader (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:185:13)
    at wrappedValidations.<computed> [as xForwardedForHeader] (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:397:22)
    at Object.keyGenerator (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:658:20)
    at /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:710:32
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:691:5 {
  code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR',
  help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
}
‚úÖ New PostgreSQL client connected
üîó Client acquired from pool
üîì Client released back to pool
üîí Auth failure: johnsmith from ::1 - Invalid credentials - curl/8.5.0
‚úÖ New PostgreSQL client connected
üîó Client acquired from pool
üîì Client released back to pool
üîó Client acquired from pool
üîì Client released back to pool
‚úÖ Auth success: admin from ::ffff:127.0.0.1 - curl/8.5.0
‚úÖ New PostgreSQL client connected
üîó Client acquired from pool
üîì Client released back to pool
üîó Client acquired from pool
üîì Client released back to pool
‚úÖ Auth success: admin from ::1 - curl/8.5.0
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:55:55.840Z'
}
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:55:56.910Z'
}
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:55:58.955Z'
}
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:56:06.136Z'
}
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:56:07.176Z'
}
Error occurred: {
  error: 'Not allowed by CORS',
  stack: 'Error: Not allowed by CORS\n' +
    '    at origin (/home/production-app/production-orders-app/src/server-refactored.js:37:16)\n' +
    '    at /home/production-app/production-orders-app/node_modules/cors/lib/index.js:219:13\n' +
    '    at optionsCallback (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:199:9)\n' +
    '    at corsMiddleware (/home/production-app/production-orders-app/node_modules/cors/lib/index.js:204:7)\n' +
    '    at Layer.handle [as handle_request] (/home/production-app/production-orders-app/node_modules/express/lib/router/layer.js:95:5)\n' +
    '    at trim_prefix (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:328:13)\n' +
    '    at /home/production-app/production-orders-app/node_modules/express/lib/router/index.js:286:9\n' +
    '    at Function.process_params (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:346:12)\n' +
    '    at next (/home/production-app/production-orders-app/node_modules/express/lib/router/index.js:280:10)\n' +
    '    at expressInit (/home/production-app/production-orders-app/node_modules/express/lib/middleware/init.js:40:5)',
  url: '/api/auth/login',
  method: 'POST',
  user: 'Anonymous',
  timestamp: '2025-08-08T08:56:09.220Z'
}
