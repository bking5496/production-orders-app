ğŸ§ª Testing refactored components...
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
âœ… Database connection: OK
âœ… Authentication middleware: OK
âœ… Response utilities: OK
âœ… Database utilities: OK
ğŸ‰ All components tested successfully!
ğŸŒ WebSocket server initialized
ğŸ§¹ WebSocket cleanup scheduler started
ğŸš€ Refactored server running on port 3001
ğŸ“Š Health check: http://localhost:3001/api/health
ğŸ” Auth test: http://localhost:3001/api/auth/login
âš™ï¸ System routes: http://localhost:3001/api/system/health
ğŸŒ WebSocket server initialized
ValidationError: The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users. See https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/ for more information.
    at Object.xForwardedForHeader (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:185:13)
    at wrappedValidations.<computed> [as xForwardedForHeader] (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:397:22)
    at Object.keyGenerator (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:658:20)
    at /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:710:32
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:691:5 {
  code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR',
  help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
âœ… Auth success: admin from ::ffff:127.0.0.1 - curl/8.5.0
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
âœ… Auth success: admin from ::1 - Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Mobile Safari/537.36 Edg/138.0.0.0
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:45.850Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:51.944Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:56.453Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:56.461Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:57.831Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:57.838Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:09:00.345Z'
}
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:09:00.371Z'
}
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
âœ… New PostgreSQL client connected
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
ğŸ”“ Client released back to pool
ğŸ”— Client acquired from pool
ğŸ”“ Client released back to pool
