🧪 Testing refactored components...
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
✅ Database connection: OK
✅ Authentication middleware: OK
✅ Response utilities: OK
✅ Database utilities: OK
🎉 All components tested successfully!
🌐 WebSocket server initialized
🧹 WebSocket cleanup scheduler started
🚀 Refactored server running on port 3001
📊 Health check: http://localhost:3001/api/health
🔐 Auth test: http://localhost:3001/api/auth/login
⚙️ System routes: http://localhost:3001/api/system/health
🌐 WebSocket server initialized
ValidationError: The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users. See https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/ for more information.
    at Object.xForwardedForHeader (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:185:13)
    at wrappedValidations.<computed> [as xForwardedForHeader] (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:397:22)
    at Object.keyGenerator (/home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:658:20)
    at /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:710:32
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /home/production-app/production-orders-app/node_modules/express-rate-limit/dist/index.cjs:691:5 {
  code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR',
  help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
}
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
✅ Auth success: admin from ::ffff:127.0.0.1 - curl/8.5.0
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
✅ Auth success: admin from ::1 - Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Mobile Safari/537.36 Edg/138.0.0.0
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
✅ New PostgreSQL client connected
🔗 Client acquired from pool
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔓 Client released back to pool
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:45.850Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:51.944Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:56.453Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:56.461Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:57.831Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:08:57.838Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:09:00.345Z'
}
🔗 Client acquired from pool
🔓 Client released back to pool
Error occurred: {
  error: 'column "created_by" of relation "users" does not exist',
  stack: 'error: column "created_by" of relation "users" does not exist\n' +
    '    at /home/production-app/production-orders-app/node_modules/pg/lib/client.js:545:17\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async DatabaseManager.query (/home/production-app/production-orders-app/src/config/database.js:38:22)\n' +
    '    at async DatabaseUtils.insert (/home/production-app/production-orders-app/src/utils/database.js:61:20)\n' +
    '    at async UsersService.createUser (/home/production-app/production-orders-app/src/services/users.service.js:132:21)\n' +
    '    at async /home/production-app/production-orders-app/src/routes/users.routes.js:127:21',
  url: '/api/users',
  method: 'POST',
  user: 'admin',
  timestamp: '2025-08-08T10:09:00.371Z'
}
✅ New PostgreSQL client connected
🔗 Client acquired from pool
✅ New PostgreSQL client connected
🔗 Client acquired from pool
🔓 Client released back to pool
🔓 Client released back to pool
🔗 Client acquired from pool
🔓 Client released back to pool
