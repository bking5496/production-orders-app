<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Debug</title>
</head>
<body>
    <h1>WebSocket Debug Test</h1>
    <div id="output"></div>
    
    <script>
        function log(message) {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
        }
        
        log('🧪 Starting WebSocket debug test...');
        
        // Check if we have cookies
        log('📄 Document cookies: ' + document.cookie);
        
        // Try to extract token
        function getTokenFromCookie() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'token') {
                    return decodeURIComponent(value);
                }
            }
            return null;
        }
        
        const token = getTokenFromCookie();
        if (token) {
            log('✅ Token found: ' + token.substring(0, 20) + '...');
            
            // Try WebSocket connection
            const wsUrl = `ws://localhost:3000?token=${encodeURIComponent(token)}`;
            log('🔗 Connecting to: ' + wsUrl.replace(/token=[^&]+/, 'token=***'));
            
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                log('✅ WebSocket connected!');
                ws.send(JSON.stringify({ type: 'ping' }));
            };
            
            ws.onmessage = (event) => {
                log('📨 Message: ' + event.data);
            };
            
            ws.onclose = (event) => {
                log(`🔌 WebSocket closed: ${event.code} - ${event.reason}`);
            };
            
            ws.onerror = (error) => {
                log('💥 WebSocket error: ' + error);
            };
            
        } else {
            log('❌ No token found in cookies');
            log('Available cookies: ' + document.cookie.split(';').map(c => c.trim().split('=')[0]).join(', '));
        }
    </script>
</body>
</html>